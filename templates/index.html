<!DOCTYPE html>
<html>
    <head>
        <title>Учет компонентов</title>
        <script type="text/javascript" src=".{{ url_for('static', filename='jquery.js') }}"></script>
        <link rel="stylesheet" type="text/css" href=".{{ url_for('static', filename='style.css') }}"/>
        <link rel="stylesheet" type="text/css" href=".{{ url_for('static', filename='modal.css') }}"/>
        <link rel="stylesheet" type="text/css" href=".{{ url_for('static', filename='jquery.dataTables.css') }}">
        <script type="text/javascript" charset="utf8" src=".{{ url_for('static', filename='jquery.dataTables.js') }}"></script>
        <script type="text/javascript" charset="utf8" src=".{{ url_for('static', filename='toolbar.js') }}"></script>
    </head>
    <body>
        <div class="wrapper" >
            <div class="header">
                <h1 style="text-align:center">УЧЕТ ЭЛЕКТРОННЫХ КОМПОНЕНТОВ</h1>
            </div>

         <!-- <div class="request">
                <form action="select1.php" method="post">
                    <p><select size="5" multiple name="hero[]">
                     <option disabled>Тип компонента</option>
                     <option value="Чебурашка">Микросхемы</option>
                     <option selected value="Крокодил Гена">Конденсаторы</option>
                     <option value="Шапокляк">Резисторы</option>
                     <option value="Крыса Лариса">Транзисторы</option>
                    </select></p>
                    <p><input type="submit" value="Применить фильтры"></p>
                   </form>
            </div> 

            <h1 style="text-align: center; margin-top: 20px; margin-bottom: 20px;">Модальное окно на чистом CSS</h1> -->  
            <div class="container">
                <div style="text-align: center;">
                <!--<a href="#openModal">Открыть модальное окно</a>-->
                <!--<input type="text" id="text" name="text" value="some text" />-->
                </div>
                <div id="openModal" class="modal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Добавление позиции</h3>
                            <a href="#close" title="Close" class="close">×</a>
                        </div>
                        <div class="modal-body">
                            <h3>Тип компонента:</h3>
                                <span class = "custom-dropdown big">
                                    <select class="tableToolbar" id = "elemType">
                                  <!--   <option>Конденсатор</option>
                                        <option>Резистор</option>
                                        <option>Катушка индуктивности</option>
                                        <option>Микросхема</option>
                                        <option>Транзистор</option>
                                        <option>Модуль</option> -->   
                                    </select>
                                </span>
                            <h3>Наименование:</h3>
                                <input type = "text"/>
                            <h3>Единицы измерения:</h3>
                                <span class = "custom-dropdown big">
                                    <select class="tableToolbar" id = "unitType">
                               <!--         <option>мкФ</option>
                                        <option>пФ</option>
                                        <option>Ом</option>
                                        <option>МОм</option>
                                        <option>кОм</option>
                                        <option>мкГн</option>
                                        <option>Гн</option> -->
                                    </select>
                                </span>
                            <h3>Значение:</h3>
                                <input type = "text"/>
                            <h3>Количество:</h3>
                            <button id="addRow">Добавить строку</button>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="table" id = "data">
                <table id="example" class="display compact" style="width:100%">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Классификация</th>
                            <th>Наименование производителя</th>
                            <th>Значение</th>
                            <th>Единицы измерения</th>
                            <th>Точность</th>
                            <th>Напряжение мощность</th>
                            <th>Корпус</th>
                            <th>Производитель</th>
                            <th>Количество</th>
                            <th>Номер ячейки</th>
                            <th>Дата изменения</th>
                        </tr>
                    </thead>
                </table>
            </div>

        </div>
    </body>

    <script>
        var container = document.getElementById("data");
        var table;

        elemType = document.querySelector('#elemType'),
        unitType = document.querySelector('#unitType');

        var resUnit = ["Ом", "кОм", "МОм"];
        var condUnit = ["пФ", "мкФ"];
        var indUnit = ["мкГн", "Гн"];

        var types = ["Конденсатор", "Резистор", "Катушка индуктивности", "Микросхема", "Транзистор", "Модуль"];
        var units = [["пФ", "мкФ"], ["Ом", "кОм", "МОм"],  ["мкГн", "Гн"]];

        // Инициализация select для типов компонентов в модальном окне
        function initAddSelect()
        {
            for (var i = 0; i < types.length; i ++)
            {
                elemType.options[i] = new Option(types[i]);
            }
        }
        // Отслеживание события select для типов компонентов в модальном окне
        elemType.addEventListener('change', function() {
            var tmp = [];
            // Выбор единиц измерения
            for (var i = 0; i < units.length; i++)
            {
                if (this.value == types[i])
                {
                    tmp = units[i];
                    break;
                }
            }

            unitType.options.length = tmp.length;

            for (var i = 0; i < tmp.length; i++)
            {
                unitType.options[i] = new Option(tmp[i]);
            }
            
        });

        

        function update()
        {
            table.destroy();

            table = $('#example').DataTable( {
                "ajax": "./get_data"
            } );
        }

        $(document).ready(function () {


            var scrollbar = document.body.clientWidth - window.innerWidth + 'px';
            console.log(scrollbar);

            
            initAddSelect();

            // Вызов события изменения select для заполнения данными
            elemType.dispatchEvent(new Event('change'));
            
            table = $('#example').DataTable( {
                "ajax": "./get_data",
                scrollY:        '60vh',
                scrollX: true,
                "language": {
                    "lengthMenu": "Показать _MENU_ записей на странице",
                    "zeroRecords": "По Вашему запросу ничего не найдено",
                    "info": "Показано страниц _PAGE_ из _PAGES_",
                    "infoEmpty": "Нет ни одной записи",
                    "infoFiltered": "(Найдено из _MAX_ записей)",
                    "search": "Поиск"
                },
                "pagingType": "full_numbers",
                "lengthMenu": [[50], [50]],
                "dom": '<"toolbar">frtip' // Включение кастомного тулбара
            } );



            //Свой тулбар
            $("div.toolbar").html(createTableToolBar().outerHTML);


            $('#example tbody').on( 'click', 'tr', function () {

                var data = table.row( this ).data();
                if ( $(this).hasClass('selected') ) {
                    $(this).removeClass('selected');
            }
            else {
                    table.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                    var cnt = document.getElementById("secelctcnt");
                    cnt.innerHTML = data[9];
                }
            } );


            document.querySelector('[href="#openModal"]').addEventListener('click', function () {
                document.body.style.overflow = 'hidden';
                document.querySelector('#openModal').style.marginLeft = scrollbar;
            });
            document.querySelector('[href="#close"]').addEventListener('click', function () {
                document.body.style.overflow = 'visible';
                document.querySelector('#openModal').style.marginLeft = '0px';
            });
            var counter = 1;
 
            $('#addRow').on( 'click', function () {
                table.row.add( [
                    counter +'.1',
                    counter +'.2',
                    counter +'.3',
                    counter +'.4',
                    counter +'.5',
                    counter +'.6'
                    
                ] ).draw( false );

                counter++;


                var link = document.createElement('a');
                link.setAttribute('href', '#close');
                link.setAttribute('close', 'close');
                link.click();

                document.body.style.overflow = 'visible';
                document.querySelector('#openModal').style.marginLeft = '0px';
            } );


            //setInterval('update()',5000);
        });
        
    </script>
</html>